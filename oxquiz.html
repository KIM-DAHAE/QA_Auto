<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="static/scss/common.css">
    <link rel="stylesheet" href="static/scss/quiz.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <title>OX 퀴즈</title>
</head>
<body>
    <header class="header">
        <h1>
            <a href="oxquiz_intro.html">
                <img src="static/images/quiz/logo.png" alt="ptkorea">
            </a>
        </h1>
        <p><strong>OX </strong>QUIZ</p>
    </header>
    <div class="container">
        <div class="contents">
            <div class="quiz__wrap">
                <div class="title">
                    <p><span class="text--orange">Y</span>OU</p>
                    <p>QA Tool</p>
                    <!-- <div class="system_done"></div> --> <!-- 241028 삭제 -->
                    <div class="timer__wrap">
                        <div class="wave_ani__wrap">
                            <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                            viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
                                <defs>
                                    <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
                                </defs>
                                <g class="wave__ani">
                                    <use xlink:href="#gentle-wave" x="48" y="0" fill="#feb95a" />
                                </g>
                            </svg>
                        </div>
                        <div class="timer"><span>45</span>:<span>00</span></div>
                        <div class="time_over__ani">
                            <img src="static/images/quiz/img_timeover.png" alt="timeover">
                        </div>
                    </div>
                    <div class="water_drop__ani">
                        <span class="water_drop1"></span>
                        <span class="water_drop2"></span>
                        <span class="water_drop3"></span>
                    </div>
                </div>
                <div class="quiz">
                    <p>Q. <span class="num"><em class="count">1</em>/10</span></p>
                    <p class="question">여기에 문제가 표시됩니다.</p>
                    <p class="tip__wrap">Tip <span class="tip">제품 여러개가 노출되면 복잡해 보이겠네요.</span></p>
                    <img src="static/images/quiz/img_question01.png" alt="q1" id="question-image">
                    <div class="btn__wrap">
                        <button type="button" class="btn btn__o">O</button>
                        <button type="button" class="btn btn__x">X</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="popup fail">
        <div class="popup__inner">
            <p class="result"><strong>아쉽습니다.</strong>시간이 너무 짧았죠. <br> 저희 QA Tool 만큼은 아니지만 <br>그래도 최선을 다해 퀴즈를 풀어주셔서<br>감사합니다.</p>
            <p class="msg">저희가 준비한 “참가상” 받아가세요!<br>ByeBye~</p>
            <a href="oxquiz_intro.html" class="btn__next">→ 다음 게임</a>
        </div>
    </div>

    <div class="popup success">
        <div class="popup__inner">
            <img src="static/images/quiz/img_success.png" alt="성공">
            <p class="result"><strong>기록! “<span class="record">21</span>초”</strong>저희 QA Tool은 0.03초만에 풀었는데…</p>
            <p class="score__wrap"><span class="score">90</span>점</p>
            <p class="msg">축하드립니다.<br>역시 콘텐츠를 보실 줄 아시는<br> <span class="text--blue">QA Master</span>를 만나게 되어 기쁩니다.</p>
            <a href="oxquiz_intro.html" class="btn__next">→ 간식받아 가세요</a>
        </div>
    </div>

    <div class="popup lose">
        <div class="popup__inner">
            <img src="static/images/quiz/img_lose.png" alt="실패">
            <p class="result"><strong>기록! “<span class="record">21</span>초”</strong>저희 QA Tool은 0.03초만에 풀었는데…</p>
            <p class="score__wrap"><span class="score">50</span>점</p>
            <p class="msg">안타깝습니다.<br>제한시간에 문제풀이를 마치셨지만, 아<br>쉽게도 기준 점수에는 부족하네요.</p>
            <a href="oxquiz_intro.html" class="btn__next">→ 간식받아 가세요</a>
        </div>
    </div>
<script>
    $(document).ready(function(){
        /* s: 241028 스크립트 삭제 */
        // setTimeout(function(){
            //     $('.system_done').addClass('active');
            // }, 1000)
        /* e: 241028 스크립트 삭제 */
            
            // 퀴즈 데이터 배열 (문제, 이미지, 정답)
        var quizData = [
            { question: "이미지 내 노출할 수 있는 제품은 오직 1개이다.", image: "static/images/quiz/img_question01.png", answer: "O", tip: "제품이 여러 개 노출되면 복잡해 보일 것 같아요."},
            { question: "동일한 시리즈의 제품은 여러 개의 제품을 함께 노출해도 된다.", image: "static/images/quiz/img_question02.png", answer: "X", tip: "UHD는 TV 구분으로 주로 사용되어요."},
            { question: "동일한 시리즈의 제품은 여러 개의 제품을 함께 노출해도 된다.", image: "static/images/quiz/img_question03.png", answer: "O", tip: "TV 화면에 같은 제품명이 쓰여 있는 것 같기도 하네요."},
            { question: "PTK의 로고는 아래와 같이 사용된다.", image: "static/images/quiz/img_question04.png", answer: "O", tip: "PTK의 정석 로고는 위와 같이 쓰여요."},
            { question: "PTK의 로고는 아래와 같이 사용된다.", image: "static/images/quiz/img_question05.png", answer: "X", tip: "PTK 로고는 단일 컬러로 이루어져있어요."},
            { question: "PTK의 로고는 아래와 같이 사용된다.", image: "static/images/quiz/img_question06.png", answer: "X", tip: "이것보다는 디자인이 들어간 형태일거에요."},
            { question: "이미지내 노출될 수 있는 제품은 오직 1개 이다.", image: "static/images/quiz/img_question07.png", answer: "O", tip: "제품이 여러 개 노출되면 복잡해 보일 것 같아요."},
            { question: "타이틀 영역에는 사용자의 의구심을 유발할 수 있는 줄임말 표현이 가능하다.", image: "static/images/quiz/img_question08.png", answer: "X", tip: "정확한 정보 표현이 노출되어야 해요."},
            { question: "제품의 배경 색상은 제품과 어울리는 컬러로 적용해도 된다.", image: "static/images/quiz/img_question09.png", answer: "X", tip: "오히려 제품이 잘 안 보이는 것 같아요."},
            { question: "제품이미지들에 맞추어 그라데이션도, 제품의 표현도 가능하다.", image: "static/images/quiz/img_question10.png", answer: "X", tip: "배경컬러는 컬러코드는 1개 코드로만 이루어져요."},
            { question: "이미지 하단 카피는 3줄까지 작성해도 된다.", image: "static/images/quiz/img_question11.png", answer: "X", tip: "카피가 너무 길어서 복잡해 보이네요."},
            { question: "이미지 하단 카피는 1줄만 작성해도 된다.", image: "static/images/quiz/img_question12.png", answer: "O", tip: ""},
            { question: "제품의 배경 색상은 규정된 #F7F7F7 컬러 코드만 적용해도 된다.", image: "static/images/quiz/img_question13.png", answer: "O"},
            { question: "제품은 잘 보이도록 되도록 크게 노출해야 한다.", image: "static/images/quiz/img_question14.png", answer: "X", tip: "너무 한 쪽에 치우쳐 있는 것 같아요."},
            { question: "여러제품 조합이 가능하며 그리드는 준수하지 않는다.", image: "static/images/quiz/img_question15.png", answer: "X", tip: "제품을 효과적으로 표현할 수 없어요."},
        ];

        var selectedQuestions = [];
        var totalQuestions = 10;
        var correctAnswers = 0;
        var score = 0;  // 점수 저장
        var currentQuestionIndex = 0;
        var timerDuration = 30; // 문제 풀이 시간 /* 241028 30초로 변경 */
        var timer;
        var startTime;
        var elapsedTime = 0; // 소요시간 저장

        function selectRandomQuestions() {
            var quizPool = quizData.slice(); 
            while (selectedQuestions.length < totalQuestions) {
                var randomIndex = Math.floor(Math.random() * quizPool.length);
                selectedQuestions.push(quizPool.splice(randomIndex, 1)[0]);
            }
            console.log("Selected Questions: ", selectedQuestions);
        }

        function showQuestion(index) {
            if (index < selectedQuestions.length) {
                var question = selectedQuestions[index];
                $(".question").text(question.question); 
                $("#question-image").attr("src", question.image);
                
                // 팁이 있는 경우만 표시
                if (question.tip) {
                    $(".tip__wrap").show();
                    $(".tip").text(question.tip);  // 문제의 팁 표시
                } else {
                    $(".tip__wrap").hide();  // 팁이 없으면 숨김
                }

                $(".count").text(index + 1);  // 현재 문제 번호 표시
            } else {
                console.error("Index out of bounds");
            }
        }

        function startTimer() {
            var seconds = timerDuration;
            var milliseconds = 0;
            startTime = Date.now();

            timer = setInterval(function() {
                var currentTime = Date.now();
                elapsedTime = Math.floor((currentTime - startTime) / 1000);  // 경과 시간 계산

                if (seconds <= 0 && milliseconds <= 0) {
                    clearInterval(timer);
                    showFailPopup();  // 시간 초과 시 실패 팝업 표시
                    $('.quiz__wrap .title').addClass("stop done"); // 시간 초과 애니메이션
                } else {
                    if (milliseconds <= 0) {
                        milliseconds = 99;
                        seconds--;
                    }
                    milliseconds--;

                    $('.timer span:first').text(seconds < 10 ? "0" + seconds : seconds);
                    $('.timer span:last').text(milliseconds < 10 ? "0" + milliseconds : milliseconds);
                }
            }, 10);
        }

        function stopTimer() {
            clearInterval(timer);
            var endTime = Date.now();
            elapsedTime = Math.floor((endTime - startTime) / 1000);  // 경과 시간 최종 계산
        }

        function checkAnswer(userAnswer) {
            if (currentQuestionIndex < selectedQuestions.length) {
                var correctAnswer = selectedQuestions[currentQuestionIndex].answer;
                if (userAnswer === correctAnswer) {
                    correctAnswers++;
                    score += 10;  // 정답일 때 10점 추가
                }
                currentQuestionIndex++;
            }

            // 마지막 문제라면 타이머 멈춤
            if (currentQuestionIndex >= totalQuestions) {
                stopTimer();  // 타이머 멈춤
                $('.quiz__wrap .title').addClass("stop");
                if (score >= 80) {
                    showSuccessPopup();  // 80점 이상일 때 성공 팝업 표시
                } else {
                    showLosePopup();  // 80점 미만일 때 실패 팝업 표시
                }
            } else {
                // 다음 문제 표시
                showQuestion(currentQuestionIndex);
            }
        }

        // 성공 팝업 표시 (소요 시간과 점수 함께 표시)
        function showSuccessPopup() {
            $(".popup.success").addClass("active");
            $(".record").text(elapsedTime);  // 소요 시간을 경과 시간으로 표시
            $(".score").text(score);  // 점수 표시
        }

        // 실패 팝업(lose) 표시 (소요 시간과 점수 함께 표시)
        function showLosePopup() {
            $(".popup.lose").addClass("active");
            $(".record").text(elapsedTime);  // 소요 시간을 경과 시간으로 표시
            $(".score").text(score);  // 점수 표시
        }

        function showFailPopup() {
            $(".popup.fail").addClass("active");
        }

        $(".btn__o").click(function() {
            checkAnswer("O");
        });

        $(".btn__x").click(function() {
            checkAnswer("X");
        });

        selectRandomQuestions();
        showQuestion(currentQuestionIndex);
        startTimer();
    })
</script>
</body>
</html>