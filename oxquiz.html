<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="static/scss/common.css">
    <link rel="stylesheet" href="static/scss/quiz.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <title>OX 퀴즈</title>
</head>
<body>
    <header class="header">
        <h1>
            <a href="oxquiz_intro.html">
                <img src="static/images/quiz/logo.png" alt="ptkorea">
            </a>
        </h1>
        <p><strong>OX </strong>QUIZ</p>
    </header>
    <div class="container">
        <div class="contents">
            <div class="quiz__wrap">
                <div class="title">
                    <p><span class="text--orange">Y</span>OU</p>
                    <p>SYSTEM</p>
                    <div class="system_done"></div>
                    <div class="timer__wrap">
                        <div class="wave_ani__wrap">
                            <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                            viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
                                <defs>
                                    <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
                                </defs>
                                <g class="wave__ani">
                                    <use xlink:href="#gentle-wave" x="48" y="0" fill="#feb95a" />
                                </g>
                            </svg>
                        </div>
                        <div class="timer"><span>45</span>:<span>00</span></div>
                        <div class="time_over__ani">
                            <img src="static/images/quiz/img_timeover.png" alt="timeover">
                        </div>
                    </div>
                    <div class="water_drop__ani">
                        <span class="water_drop1"></span>
                        <span class="water_drop2"></span>
                        <span class="water_drop3"></span>
                    </div>
                </div>
                <div class="quiz">
                    <p>Q. <span class="num"><em class="count">1</em>/10</span></p>
                    <p class="question">여기에 문제가 표시됩니다.</p>
                    <img src="static/images/quiz/img_question01.png" alt="q1" id="question-image">
                    <p class="tip__wrap">Tip <span class="tip">제품 여러개가 노출되면 복잡해 보이겠네요.</span></p>
                    <div class="btn__wrap">
                        <button type="button" class="btn btn__o">O</button>
                        <button type="button" class="btn btn__x">X</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="popup fail">
        <div class="popup__inner">
            <p class="result"><strong>아쉽습니다.</strong>시간이 너무 적긴 했죠. <br> 저희 Tool 과 lv 을 맞추다 보니, <br>그래도 “휴먼” 인데 대단하세요.</p>
            <p class="msg">아쉬운 결과를 드려 죄송하지만, <br>그래도 <span>룰은 룰이니깐요,</span><br>좋은 하루되세요.<br>Bye~Bye</p>
            <a href="oxquiz_intro.html" class="btn__next">→ 다음 게임</a>
        </div>
    </div>

    <div class="popup success">
        <div class="popup__inner">
            <img src="static/images/quiz/img_success.png" alt="성공">
            <p class="result"><strong>기록! “<span class="record">21</span>초”</strong>저희 Tool은 0.03초인데</p>
            <p class="score__wrap"><span class="score">90</span>점</p>
            <p class="msg">축하드려요.<br>역시 콘텐츠를 보실 줄 아시는<br> <span class="text--blue">귀인</span>을 만나게 되어 기쁩니다.</p>
            <a href="oxquiz_intro.html" class="btn__next">→ 간식받아 가세요</a>
        </div>
    </div>

    <div class="popup lose">
        <div class="popup__inner">
            <img src="static/images/quiz/img_lose.png" alt="실패">
            <p class="result"><strong>기록! “<span class="record">21</span>초”</strong>저희 Tool은 0.03초인데</p>
            <p class="score__wrap"><span class="score">50</span>점</p>
            <p class="msg">안타깝습니다.<br>제안시간에 문제풀이를 마치셨<br> 지만, 기준 점수에는 미달이에요.</p>
            <a href="oxquiz_intro.html" class="btn__next">→ 간식받아 가세요</a>
        </div>
    </div>
<script>
    $(document).ready(function(){
        setTimeout(function(){
            $('.system_done').addClass('active');
        }, 30)
        
        // 퀴즈 데이터 배열 (문제, 이미지, 정답)
        var quizData = [
            { question: "이미지내 노출될 수 있는 제품은 오직 1개 이다.", image: "static/images/quiz/img_question01.png", answer: "O", tip: "제품 여러개가 노출되면 복잡해 보이겠네요."},
            { question: "비슷한 제품군은 2개 이상 노출 가능하다.", image: "static/images/quiz/img_question02.png", answer: "X", tip: "모니터와 TV가 비슷하게 보이긴해요."},
            { question: "동일한 시리즈의 제품은 여러개의 제품 노출로 디자인 가능하다.", image: "static/images/quiz/img_question03.png", answer: "O", tip: "둘다 Neo QLED 라서 같은 시리즈네요."},
            { question: "PTK의 로고는 아래와 같이 사용된다.", image: "static/images/quiz/img_question04.png", answer: "O", tip: "PTK 로고 정석입니다."},
            { question: "PTK의 로고는 아래와 같이 사용된다.", image: "static/images/quiz/img_question05.png", answer: "X", tip: "PTK 로고는 단일 컬러로 이루어져있어요."},
            { question: "PTK의 로고는 아래와 같이 사용된다.", image: "static/images/quiz/img_question06.png", answer: "X", tip: "이건 로고보다는 텍스트 같죠?"},
            { question: "이미지내 노출될 수 있는 제품은 오직 1개 이다.", image: "static/images/quiz/img_question07.png", answer: "O", tip: "제품 여러개가 노출되면 복잡해 보이겠네요."},
            { question: "타이틀 영역에는 사용자의 의구심을 유발할 수 있는 줄임말 표현이 가능하다.", image: "static/images/quiz/img_question08.png", answer: "X", tip: "정확한 정보 표현이 노출되어야 해요."},
            { question: "제품의 배경 컬러는 제품에 맞는 컬러로 배치하여 노출 가능하다.", image: "static/images/quiz/img_question09.png", answer: "X", tip: "Align 맞춘 배경들이 더 깔끔해요."},
            { question: "가이드에 준수된 표현일까요?", image: "static/images/quiz/img_question10.png", answer: "X", tip: "배경컬러는 컬러코드딱 1개에요."},
            { question: "카피는 최대 3Line 까지 노출 가능하다.", image: "static/images/quiz/img_question11.png", answer: "X", tip: "카피가 너무 길면 복잡해 보여요."},
            { question: "카피는 1Line 만 적용해도 된다.", image: "static/images/quiz/img_question12.png", answer: "O", tip: "최대 2Line 이니 1Line도 괜찮죠."},
            { question: "제품의 배경 컬러는 규정된 #F4F4F4 컬러 코드만 적용 가능하다.", image: "static/images/quiz/img_question13.png", answer: "O", tip: "Guide 컬러가 잘 반영되어 있네요."},
            { question: "제품은 꽉 차게 크게 노출 시킨다.", image: "static/images/quiz/img_question14.png", answer: "X", tip: "규정된 상하좌우 마진값에 오버되어 보여요."},
            { question: "여러제품 조합이 가능하며 그리드는 준수하지 않는다.", image: "static/images/quiz/img_question15.png", answer: "X", tip: "제품을 효과적으로 표현할 수 없어요."},
        ];

        var selectedQuestions = [];
        var totalQuestions = 10;
        var correctAnswers = 0;
        var score = 0;  // 점수 저장
        var currentQuestionIndex = 0;
        var timerDuration = 45; // 문제 풀이 시간
        var timer;
        var startTime;
        var elapsedTime = 0; // 소요시간 저장

        function selectRandomQuestions() {
            var quizPool = quizData.slice(); 
            while (selectedQuestions.length < totalQuestions) {
                var randomIndex = Math.floor(Math.random() * quizPool.length);
                selectedQuestions.push(quizPool.splice(randomIndex, 1)[0]);
            }
            console.log("Selected Questions: ", selectedQuestions);
        }

        function showQuestion(index) {
            if (index < selectedQuestions.length) {
                var question = selectedQuestions[index];
                $(".question").text(question.question); 
                $("#question-image").attr("src", question.image);
                $(".tip").text(question.tip);  // 문제의 팁 표시
                $(".count").text(index + 1);  // 현재 문제 번호 표시
            } else {
                console.error("Index out of bounds");
            }
        }

        function startTimer() {
            var seconds = timerDuration;
            var milliseconds = 0;
            startTime = Date.now();

            timer = setInterval(function() {
                var currentTime = Date.now();
                elapsedTime = Math.floor((currentTime - startTime) / 1000);  // 경과 시간 계산

                if (seconds <= 0 && milliseconds <= 0) {
                    clearInterval(timer);
                    showFailPopup();  // 시간 초과 시 실패 팝업 표시
                    $('.quiz__wrap .title').addClass("stop done"); // 시간 초과 애니메이션
                } else {
                    if (milliseconds <= 0) {
                        milliseconds = 99;
                        seconds--;
                    }
                    milliseconds--;

                    $('.timer span:first').text(seconds < 10 ? "0" + seconds : seconds);
                    $('.timer span:last').text(milliseconds < 10 ? "0" + milliseconds : milliseconds);
                }
            }, 10);
        }

        function stopTimer() {
            clearInterval(timer);
            var endTime = Date.now();
            elapsedTime = Math.floor((endTime - startTime) / 1000);  // 경과 시간 최종 계산
        }

        function checkAnswer(userAnswer) {
            if (currentQuestionIndex < selectedQuestions.length) {
                var correctAnswer = selectedQuestions[currentQuestionIndex].answer;
                if (userAnswer === correctAnswer) {
                    correctAnswers++;
                    score += 10;  // 정답일 때 10점 추가
                }
                currentQuestionIndex++;
            }

            // 마지막 문제라면 타이머 멈춤
            if (currentQuestionIndex >= totalQuestions) {
                stopTimer();  // 타이머 멈춤
                $('.quiz__wrap .title').addClass("stop");
                if (score >= 80) {
                    showSuccessPopup();  // 80점 이상일 때 성공 팝업 표시
                } else {
                    showLosePopup();  // 80점 미만일 때 실패 팝업 표시
                }
            } else {
                // 다음 문제 표시
                showQuestion(currentQuestionIndex);
            }
        }

        // 성공 팝업 표시 (소요 시간과 점수 함께 표시)
        function showSuccessPopup() {
            $(".popup.success").addClass("active");
            $(".record").text(elapsedTime);  // 소요 시간을 경과 시간으로 표시
            $(".score").text(score);  // 점수 표시
        }

        // 실패 팝업(lose) 표시 (소요 시간과 점수 함께 표시)
        function showLosePopup() {
            $(".popup.lose").addClass("active");
            $(".record").text(elapsedTime);  // 소요 시간을 경과 시간으로 표시
            $(".score").text(score);  // 점수 표시
        }

        function showFailPopup() {
            $(".popup.fail").addClass("active");
        }

        $(".btn__o").click(function() {
            checkAnswer("O");
        });

        $(".btn__x").click(function() {
            checkAnswer("X");
        });

        selectRandomQuestions();
        showQuestion(currentQuestionIndex);
        startTimer();
    })
</script>
</body>
</html>